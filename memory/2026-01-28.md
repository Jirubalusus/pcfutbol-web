# 2026-01-28 - Sesión PC Fútbol Web: Sistema de Estadio V2

## Resumen
Sesión muy productiva. Implementamos el sistema completo de estadio con economía realista.

## Cambios Principales

### Sistema de Estadio
- **Visor 3D** con React Three Fiber - estadio que cambia según nivel
- **Capacidades reales** por equipo (Bernabéu 80k, Villamarín 60k, etc.)
- **Archivo stadiumCapacities.js** con ~100 equipos mapeados
- Estadio inicial según equipo elegido, no genérico

### Sistema de Abonos
- **Campaña de abonos** con periodo de cierre (jornadas 1-4)
- Abonados calculados automáticamente según: precio, overall equipo, posición liga, reputación
- No controlables manualmente - se ganan según proyecto
- Precio del abono separado del precio de entrada

### Economía de Partidos
- **Precio entrada** afecta solo a taquilla (no abonados)
- Precios altos → taquilla vacía, abonados siguen viniendo
- Factores: derby (+30%), rival grande (+50%), posición en liga
- **600 simulaciones** validadas sin bugs

### Sistema de Césped
- Afecta **lesiones del local** (césped malo = más riesgo)
- Visitante no afectado
- UI informativa con colores y porcentajes
- Se daña con eventos, recupera +5%/semana

### Bugs Corregidos
- `state.table` → `state.leagueTable`
- Validación de `team` antes de acceder a `.players`
- `formatMoney` redondeando números pequeños
- Merge de estado en UPDATE_STADIUM

## Archivos Clave Modificados
- `src/components/Stadium/Stadium.jsx`
- `src/components/Stadium3D/Stadium3D.jsx` (nuevo)
- `src/game/stadiumEconomy.js`
- `src/game/leagueEngine.js`
- `src/data/stadiumCapacities.js` (nuevo)
- `src/context/GameContext.jsx`
- `src/components/TeamSelection/TeamSelection.jsx`

## Tests Creados
- `test-stadium-simulation.js` - 600 temporadas
- `test-full-simulation.js` - flujo completo
- `test-derby.js` - comparativa partidos

## Estado Final
- Deploy funcionando en GitHub Pages
- Balance económico suavizado (97-100% rentable)
- Estadio 3D visible y funcional
- Sistema de abonos realista
