# 2026-02-01 — Implementación Sudamérica en PC Fútbol Web

## Resumen del día
Pol pidió implementar Sudamérica completa en PC Fútbol Web. Trabajo masivo ejecutado con múltiples sub-agentes en paralelo.

## Lo que se hizo

### Scraping (10 ligas SA)
- 178 equipos, 5219 jugadores scrapeados de Transfermarkt
- Argentina (30), Brasil (20), Colombia (20), Chile (16), Uruguay (16), Ecuador (16), Paraguay (12), Perú (18), Bolivia (16), Venezuela (14)
- Datos subidos a Firestore con IDs: argentinaPrimera, brasileiraoA, colombiaPrimera, chilePrimera, uruguayPrimera, ecuadorLigaPro, paraguayPrimera, peruLiga1, boliviaPrimera, venezuelaPrimera

### Código implementado
- **LEAGUE_CONFIG** (multiLeagueEngine.js): 10 ligas SA con zonas libertadores/sudamericana
- **Copa Libertadores + Copa Sudamericana** (southAmericanCompetitions.js + southAmericanSeason.js): formato Swiss 32 equipos, knockout, premios
- **Copas nacionales**: 10 copas SA en cupSystem.js
- **Tiers económicos**: Argentina/Brasil Tier 2 (x0.50), Colombia/Chile/Uruguay/Ecuador Tier 3 (x0.22), Paraguay/Perú/Bolivia/Venezuela Tier 4 (x0.08)
- **Apertura/Clausura**: 9 ligas SA con torneos divididos, tabs Apertura|Clausura|Acumulada en LeagueTable
- **TeamSelection**: Selector de continente Europa/Sudamérica, mapa SA (SouthAmericaMap.jsx)
- **Competitions UI**: SouthAmerica.jsx para Libertadores/Sudamericana
- **GameContext**: Integración completa SA (INIT_SA_COMPETITIONS, COMPLETE_SA_MATCH, etc.)
- **SeasonEnd**: Clasificación a Libertadores/Sudamericana

### Bugs encontrados y corregidos
1. **Estadios**: Todos SA tenían "Estadio Municipal 8000" → Añadidos 100+ estadios reales (Monumental 84K, Bombonera 54K, Maracanã 78K, etc.)
2. **Salarios**: Scraper no aplicaba tier → Cambiado applyGeneratedSalaries() para siempre regenerar con tier correcto
3. **Argentina sin A/C**: Cambiado de 'standard' a 'apertura-clausura'

### Bugfixes adicionales (sesión tarde/noche)
- **Renovación jugadores 34+**: demandedYears mínimo 2, excluir recién renovados de lista de atención
- **Hueco vacío mobile**: selector país con min-height 300px → colapsar cuando WorldMap null
- **Rojas/amarillas/lesiones**: event.player era objeto {name} en V2, no string → normalizado
- **Lineup sancionados**: ADD_RED_CARDS/ADD_YELLOW_CARDS ahora limpian lineup correctamente
- **MatchDay/Stadium**: getAllTeams() faltaban 22 ligas (SA + europeas menores)
- **Tarjetas europeas/continentales**: no se procesaban → corregido
- **Masas salariales SA**: nuevo salaryMult desacoplado del tier general
  - Argentina x0.18, Brasil x0.22, Colombia/Chile/Uruguay/Ecuador x0.07, Paraguay/Peru/Bolivia/Venezuela x0.025
  - Resultado: Boca pasó de 44.6M→16.2M/año (ratio 3x→1.1x, realista)

### Nuevas features (sesión tarde/noche)
- **Cesiones (TransfersV2)**: Tab completa con 4 sub-tabs para gestión de préstamos
- **Sistema de notificaciones**: NotificationCenter con toasts por prioridad + badge unread en sidebar
- **Bancarrota→despido**: Corregido flujo
- **Renovación cross-season**: Arreglada
- **MoneyInput K format**: Formato corregido
- **European sim**: Fix general
- **Globo unificado**: Europa+SA sin selector de continente separado

### Al final del día
- Pol reportó que las ligas españolas (LaLiga, Segunda, 1ª RFEF, 2ª RFEF) tienen equipos/plantillas mal
- Lanzado re-scraping de las 4 ligas españolas (sub-agente spain-rescrape)
- Re-scraping completado y subido a Firestore

## Arquitectura clave (para referencia futura)
- Datos: Scraper → JSON (public/data/) → Firestore → App carga de Firestore (teamsFirestore.js)
- Upload script: scripts/upload-to-firestore.mjs
- Ligas SA detectadas por isSouthAmericanLeague() helper
- Competiciones SA paralelas a las europeas (no se mezclan)
- Salarios se regeneran SIEMPRE al crear partida (no se usan los del scraper)
