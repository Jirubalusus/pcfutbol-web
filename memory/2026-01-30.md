# 2026-01-30 ‚Äî Sesi√≥n muy productiva

## Cambios implementados en PC F√∫tbol Web

### Sistema de precios de entrada din√°mico
- Precio de entrada ahora afecta la ocupaci√≥n del estadio (calculatePriceFactor)
- Precio justo din√°mico seg√∫n: divisi√≥n, overall equipo, reputaci√≥n, posici√≥n en liga
- Equipo top en 1¬™ puede cobrar ‚Ç¨120, equipo de 2¬™ mitad tabla ~‚Ç¨25
- Ocupaci√≥n afecta factor cancha de forma gradual (0-3% bonus)
- homeBonus en simulaci√≥n: de 2 (estadio vac√≠o) a 8 (lleno) ‚Äî ya no fijo

### Tarjetas rojas aumentadas
- De 5% a 18% base por equipo/partido (~7 rojas/temporada, realista)
- T√°cticas agresivas (highPress/defensive) multiplican probabilidad

### Sistema de renovaci√≥n v2
- Solo se puede renovar jugadores con ‚â§2 a√±os de contrato
- Cooldown 30 semanas tras renovar
- Demanda salarial realista por edad:
  - J√≥venes (<23): piden menos, muchos a√±os
  - Prime (24-30): piden m√°s
  - Veteranos (34+): piden menos, saben que est√°n en declive
- Factores: potencial (j√≥venes), rendimiento (minutos jugados)

### Secci√≥n Banco (Finance)
- Nueva secci√≥n en sidebar con icono Landmark
- Muestra balance temporada actual: ingresos y gastos reales
- Quitado el "Balance Anual Estimado" del estadio (centralizado en Banco)
- Corregido bug de ‚Ç¨48M fantasma (weeklyIncome √ó 52 era incorrecto)

### UI/UX fixes
- Quitado texto "Seleccionado" de tarjetas pretemporada (el borde azul basta)
- Bot√≥n "Saltar al final" en partido: movido ANTES de los eventos (entre posesi√≥n y eventos)
- Modal renovaci√≥n: cajas sim√©tricas, sin emojis WhatsApp, verde suavizado (#2d8a4e)
- Tarjetas estadio: align-items stretch para igualar alturas
- Campa√±a cerrada: flex:1 para rellenar espacio sin hueco

### Competiciones europeas (EN PROGRESO)
- Sub-agente trabajando en Champions League, Europa League, Conference League
- Formato Swiss System (nuevo formato 2024/25)
- 4 sprints: motor, calendario, UI, conexi√≥n season end
- Arquitectura escalable para a√±adir m√°s ligas despu√©s
- Sprint 1-3 completados, Sprint 4 en progreso

## Archivos clave modificados
- `src/game/stadiumEconomy.js` ‚Äî calculateFairPrice, calculatePriceFactor con fairPrice din√°mico
- `src/game/matchSimulationV2.js` ‚Äî homeBonus con attendanceFillRate, rojas 18%
- `src/components/Plantilla/Plantilla.jsx` ‚Äî renovaci√≥n v2, wantsToRenew
- `src/components/Finance/Finance.jsx` + `.scss` ‚Äî NUEVO componente Banco
- `src/components/MatchDay/MatchDay.jsx` + `.scss` ‚Äî skip button reposicionado
- `src/components/Stadium/Stadium.jsx` ‚Äî quitado balance anual

### Sesi√≥n nocturna (21:55 - 23:48)

#### Seguridad Firebase
- Movidas todas las API keys de Firebase a `.env` (antes hardcodeadas en 7 archivos)
- `src/firebase/config.js` usa `import.meta.env.VITE_*`
- Scripts usan `scripts/firebase-config.mjs` compartido con dotenv
- Creado `firestore.rules`: leagues/teams read-only, deny all else
- `.env` a√±adido a `.gitignore`, `.env.example` como referencia
- **Pendiente de Pol:** rotar API keys en Google Cloud Console + deploy rules

#### Bugs de Fichajes (MoneyInput)
- Aceleraci√≥n de +/- era brutal (x10 en 2.4s) ‚Üí ahora suave (x3 max, 150ms/tick, 500ms delay)
- Salario mostraba "18K /sem" ‚Üí ahora todo en formato M: "0.1M /sem"
- `formatTransferPrice()` siempre devuelve formato M
- Salarios iniciales redondeados a 0.1M (100K)

#### Calendario m√≥vil
- Nombres truncados "G." "C." ‚Üí ahora muestra c√≥digos 3 letras (GER, BAR, etc)
- Desktop sigue mostrando nombres completos
- Selector de jornadas: scroll horizontal en m√≥vil en vez de wrap

#### Equipos Liga/Segunda
- Movidos Las Palmas y Legan√©s de LaLiga ‚Üí Segunda
- LaLiga: 20 equipos, Segunda: 22 equipos
- Actualizado JSON local + Firestore

#### Preseason cards m√≥vil
- `:hover` solo en desktop (`@media (hover: hover)`)
- A√±adido `:active` y `touch-action: manipulation`
- `.selected` m√°s visible: glow + t√≠tulo azul + `!important`

#### Tests
- Pol pregunt√≥ si crear bater√≠a de tests (Cypress/Jest/RTL) ‚Üí decidido que NO
- Testing pragm√°tico: solo si algo se rompe, testear esa l√≥gica

## Notas
- Pol prefiere NO estimaciones futuras en Banco, solo temporada actual
- Los emojis de WhatsApp (‚úÖüí∞‚úçÔ∏è) se consideran feos ‚Üí usar texto limpio
- El verde #30d158 es demasiado chill√≥n ‚Üí usar #2d8a4e
- Tests no merecen la pena en proyecto personal con dev r√°pido
