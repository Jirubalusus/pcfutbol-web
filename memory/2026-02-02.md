# 2026-02-02 - SesiÃ³n de desarrollo PC FÃºtbol Web

## Bugs arreglados
- **React error #300 en producciÃ³n**: `useCallback` en `WorldMap.jsx` estaba DESPUÃ‰S de un `if (isMobile) return` â€” violaba reglas de hooks. Movido antes del condicional. Solo se manifestaba en mÃ³vil.
- **Mensajes "Fichaje Fallido" descentrados**: `.fail-reason` necesitaba `margin: auto` y `.block-notice` necesitaba `text-align: center` en `TransfersV2.scss`
- **Temporada incorrecta**: MainMenu decÃ­a "2024-2025", cambiado a "2025-2026"

## Pretemporada simplificada
- `seasonManager.js`: 3 opciones 100% aleatorias (sin categorÃ­as prestigio/equilibrada/regional)
- Partidos 1-4 siempre fuera, partido 5 siempre en casa (presentaciÃ³n)
- Sin dificultad, sin ingresos potenciales â€” solo rivales con OVR
- BotÃ³n "Comenzar Temporada" sticky en mÃ³vil

## 4 nuevas ligas aÃ±adidas (Resto del Mundo)
- ğŸ‡ºğŸ‡¸ MLS (20 equipos) â€” `teams-mls.js`
- ğŸ‡¸ğŸ‡¦ Saudi Pro League (18 equipos) â€” `teams-saudi.js`
- ğŸ‡²ğŸ‡½ Liga MX (18 equipos) â€” `teams-ligamx.js`
- ğŸ‡¯ğŸ‡µ J-League (20 equipos) â€” `teams-jleague.js`
- Datos generados por IA, NO scrapeados â€” Pol quiere scrapear Transfermarkt para datos reales
- Integradas en: teamsFirestore.js, TeamSelection.jsx, multiLeagueEngine.js, leagueTiers.js, WorldMap.jsx
- CategorÃ­a "Resto del Mundo" en el selector (globe + mobile list)
- Tiers: Saudi tier 2, Liga MX tier 2, MLS tier 3, J-League tier 3

## Steam - Plan de publicaciÃ³n
- **Pol quiere publicar en Steam** â€” idea seria, no curiosidad
- Steamworks: cuenta creada, esperando validaciÃ³n (2-7 dÃ­as)
- **Estrategia legal**: Ficcionalizar nombres (tipo PES option files)
  - Juego sale con nombres falsos parecidos pero legales
  - Sistema de Editor con modo PÃºblico (revisado) y Privado (libre)
  - "Casualmente" alguien de la comunidad (nosotros) sube un pack pÃºblico con datos reales desde dÃ­a 1
- **Nombre del juego**: brainstorming en curso, favoritos: "The Gaffer", "Dugout", "Touchline" (Pol quiere nombres en inglÃ©s)
- **Todo el juego debe pasar a inglÃ©s** eventualmente
- MigraciÃ³n tÃ©cnica: React â†’ Electron/Tauri, Firebase â†’ SQLite local, Steamworks SDK
- Primero: store page "Coming Soon" para generar wishlists

## RevisiÃ³n de claude-mem
- Pol preguntÃ³ por seguridad de github.com/thedotmack/claude-mem
- Tiene token crypto $CMEM en Solana â€” red flag enorme
- Captura TODO lo que hace Claude Code (hooks en cada lifecycle event)
- Servidor HTTP local sin auth en puerto 37777
- Veredicto: no recomendable por trust issues con el token crypto

## Scraping Transfermarkt completado âœ…
- Script Node.js (`scrape-transfermarkt.js`) con cheerio para parsear HTML
- Datos extraÃ­dos: nombre, posiciÃ³n (mapeada POR/DFC/LTI/etc), edad, valor mercado, nacionalidad (en espaÃ±ol)
- OVR calculado algorÃ­tmicamente desde valor de mercado + edad
- 4 ligas scrapeadas:
  - ğŸ‡ºğŸ‡¸ **MLS**: 30 equipos (era 20, ahora incluye los 30 reales â€” San Diego FC nuevo 2025)
  - ğŸ‡¸ğŸ‡¦ **Saudi Pro League**: 18 equipos (Al-Qadsiah, NEOM SC nuevos)
  - ğŸ‡²ğŸ‡½ **Liga MX**: 18 equipos âœ…
  - ğŸ‡¯ğŸ‡µ **J-League**: 20 equipos (Mito HollyHock, JEF United Chiba, Fagiano Okayama, Shimizu S-Pulse, V-Varen Nagasaki promovidos)
- Total: **86 equipos, ~1968 jugadores** con datos reales
- Metadatos (colores, ciudades, estadios, reputaciÃ³n) preservados de archivos existentes + nuevos equipos aÃ±adidos
- Build pasa âœ…
- Estrellas verificadas: Messi 85, CR7 85, De Paul 79, Riqui Puig 81, ManÃ© 75, Benzema 77

## Modo Contrarreloj ğŸ•
- Nuevo modo de juego: adivinar equipos contra el reloj
- Setup completo: selecciÃ³n de tiempo, pantalla de juego, fin de partida
- **Ranking compartido** vÃ­a Firebase (colecciÃ³n `contrarreloj_ranking`)
- DetecciÃ³n de win/lose + end screen con estadÃ­sticas
- **GarantÃ­a de diversidad**: siempre 1 equipo de Europa + 1 de SudamÃ©rica en la selecciÃ³n
- **Bug fix "Nuevos equipos"**: ya no hace `window.location.reload()`, usa React state directamente
- Pendiente: Firebase Security Rules para `contrarreloj_ranking` (allow read: all, write: authenticated)
- Pendiente: RestricciÃ³n API key Firebase en Google Cloud Console
- Deploy a GitHub Pages completado âœ…

## SesiÃ³n nocturna (02:00-02:10) â€” Mejoras Contrarreloj + SimulaciÃ³n

### SimulaciÃ³n cambiada
- Solo 2 opciones: "3 partidos" o "Mercado de invierno" (o "Fin de temporada" si ya pasÃ³)
- Mercado invernal: 3 jornadas (antes era 1), con banner â„ï¸ y estilo visual azul hielo
- Dashboard cambia visualmente: Office, Sidebar, MobileNav con modo winter

### Contrarreloj â€” Solo Europa/SudamÃ©rica
- Eliminadas ligas Resto del Mundo (MLS, Saudi, Liga MX, J-League) del pool contrarreloj
- Segunda RFEF incluida de nuevo

### Panel "Camino a la Gloria"
- Reemplaza Objetivos en modo contrarreloj
- Timeline vertical: inicio â†’ temporadas â†’ ascensos â†’ europa â†’ meta
- `contrarrelojData.seasonHistory` nuevo en GameContext
- `CONTRARRELOJ_RECORD_SEASON` conectado a START_NEW_SEASON
- Stats acumuladas: totalWins/Draws/Losses/Matches

### Pantalla final mejorada
- Mejor jugador (mayor OVR)
- Stats de la run: partidos, victorias, empates, derrotas, % victoria
- PalmarÃ©s completo
- Temporadas (nÃºmero grande al final)
- PosiciÃ³n global en ranking (% si <10k jugadores, posiciÃ³n absoluta si â‰¥10k)
- `getRankingPosition()` nueva en rankingService.js (usa getCountFromServer)

### GitHub caÃ­do ~2h
- Partial System Outage desde ~23:00 hasta ~02:00
- Cron de monitoreo cada 5 min, avisÃ© cuando volviÃ³

## Nota tÃ©cnica
- Transfermarkt es scraping viable (devuelve datos 2025-26 reales via web_fetch + cheerio)
- Nacionalidades extraÃ­das de `img.flaggenrahmen[title]` en HTML
- SoFIFA bloqueado por Cloudflare
- Scripts de scraping en: `scrape-transfermarkt.js` y `merge-teams.js`
- JSONs raw en: `scraped-{mls,saudi,ligamx,jleague}.json`
