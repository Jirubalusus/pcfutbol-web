{"version":3,"file":"rankedSimulation-7RxagVfD.js","sources":["../../src/game/rankedSimulation.js"],"sourcesContent":["// ============================================================\r\n// RANKED SIMULATION — Full season simulation for Ranked 1v1\r\n// Uses the real game engine (leagueEngine, cupSystem, etc.)\r\n// ============================================================\r\n\r\nimport { initializeLeague, generateFixtures, simulateMatch } from './leagueEngine';\r\nimport { generateAIForm } from './formSystem';\r\nimport { calculateTeamStrength } from './gameShared';\r\nimport { EUROPEAN_SPOTS, LEAGUE_MATCHDAYS } from './seasonManager';\r\n\r\n// ============================================================\r\n// SIMULATE HALF SEASON\r\n// Simulates jornadas 1 to midpoint\r\n// ============================================================\r\nexport function simulateHalfSeason(leagueTeams, player1TeamId, player2TeamId, player1Config, player2Config, leagueId) {\r\n  const totalMatchdays = LEAGUE_MATCHDAYS[leagueId] || 38;\r\n  const midpoint = Math.floor(totalMatchdays / 2);\r\n  \r\n  // Initialize league\r\n  const { table, fixtures } = initializeLeague(leagueTeams, null); // no single playerTeamId\r\n  \r\n  // Build team lookup\r\n  const teamMap = {};\r\n  leagueTeams.forEach(t => { teamMap[t.id] = t; });\r\n  \r\n  // H2H tracker\r\n  const h2h = { player1: [], player2: [] };\r\n  \r\n  // Simulate first half\r\n  const firstHalfFixtures = fixtures.filter(f => f.week <= midpoint);\r\n  \r\n  for (const fixture of firstHalfFixtures) {\r\n    const homeTeam = teamMap[fixture.homeTeam];\r\n    const awayTeam = teamMap[fixture.awayTeam];\r\n    if (!homeTeam || !awayTeam) continue;\r\n    \r\n    // Determine form/tactics for player teams\r\n    const context = buildMatchContext(fixture, homeTeam, awayTeam, player1TeamId, player2TeamId, player1Config, player2Config);\r\n    \r\n    const result = simulateMatch(\r\n      fixture.homeTeam, fixture.awayTeam,\r\n      homeTeam, awayTeam,\r\n      context, {}, null\r\n    );\r\n    \r\n    fixture.homeScore = result.homeGoals;\r\n    fixture.awayScore = result.awayGoals;\r\n    fixture.played = true;\r\n    fixture.events = result.events || [];\r\n    \r\n    // Update table\r\n    updateTable(table, fixture);\r\n    \r\n    // Track H2H\r\n    trackH2H(fixture, player1TeamId, player2TeamId, h2h);\r\n  }\r\n  \r\n  // Sort table\r\n  sortTable(table);\r\n  \r\n  return {\r\n    table: table.map(t => ({ ...t })),\r\n    fixtures,\r\n    h2h,\r\n    midpoint,\r\n    totalMatchdays,\r\n    leagueId\r\n  };\r\n}\r\n\r\n// ============================================================\r\n// SIMULATE FULL SEASON (second half + cups)\r\n// Takes the state from half season and completes it\r\n// ============================================================\r\nexport function simulateFullSeason(halfSeasonState, leagueTeams, player1TeamId, player2TeamId, player1Config, player2Config) {\r\n  const { table, fixtures, h2h, midpoint, totalMatchdays, leagueId } = halfSeasonState;\r\n  \r\n  const teamMap = {};\r\n  leagueTeams.forEach(t => { teamMap[t.id] = t; });\r\n  \r\n  // Simulate second half\r\n  const secondHalfFixtures = fixtures.filter(f => f.week > midpoint && !f.played);\r\n  \r\n  for (const fixture of secondHalfFixtures) {\r\n    const homeTeam = teamMap[fixture.homeTeam];\r\n    const awayTeam = teamMap[fixture.awayTeam];\r\n    if (!homeTeam || !awayTeam) continue;\r\n    \r\n    const context = buildMatchContext(fixture, homeTeam, awayTeam, player1TeamId, player2TeamId, player1Config, player2Config);\r\n    \r\n    const result = simulateMatch(\r\n      fixture.homeTeam, fixture.awayTeam,\r\n      homeTeam, awayTeam,\r\n      context, {}, null\r\n    );\r\n    \r\n    fixture.homeScore = result.homeGoals;\r\n    fixture.awayScore = result.awayGoals;\r\n    fixture.played = true;\r\n    fixture.events = result.events || [];\r\n    \r\n    updateTable(table, fixture);\r\n    trackH2H(fixture, player1TeamId, player2TeamId, h2h);\r\n  }\r\n  \r\n  sortTable(table);\r\n  \r\n  // Determine league positions\r\n  const p1Pos = table.findIndex(t => t.teamId === player1TeamId) + 1;\r\n  const p2Pos = table.findIndex(t => t.teamId === player2TeamId) + 1;\r\n  \r\n  // Simulate cup (simplified: knockout bracket with real match engine)\r\n  const cupResult = simulateCup(leagueTeams, teamMap, player1TeamId, player2TeamId);\r\n  \r\n  // Determine European competition results based on league position\r\n  const europeanSpots = EUROPEAN_SPOTS[leagueId] || {};\r\n  const p1European = getEuropeanCompetition(p1Pos, europeanSpots);\r\n  const p2European = getEuropeanCompetition(p2Pos, europeanSpots);\r\n  \r\n  // Simulate European competitions (simplified probability based on team strength)\r\n  const p1EuropeanResult = p1European ? simulateEuropeanRun(teamMap[player1TeamId], p1European) : null;\r\n  const p2EuropeanResult = p2European ? simulateEuropeanRun(teamMap[player2TeamId], p2European) : null;\r\n  \r\n  return {\r\n    table,\r\n    player1: {\r\n      teamId: player1TeamId,\r\n      teamName: teamMap[player1TeamId]?.name,\r\n      leaguePosition: p1Pos,\r\n      leaguePoints: table.find(t => t.teamId === player1TeamId)?.points || 0,\r\n      liga: p1Pos === 1,\r\n      copa: cupResult.winner === player1TeamId,\r\n      championsLeague: p1EuropeanResult?.won && p1European === 'champions',\r\n      europaLeague: p1EuropeanResult?.won && p1European === 'europaLeague',\r\n      conference: p1EuropeanResult?.won && p1European === 'conference',\r\n      libertadores: p1EuropeanResult?.won && p1European === 'libertadores',\r\n      sudamericana: p1EuropeanResult?.won && p1European === 'sudamericana',\r\n      supercopa: false, // Simplified: not simulated\r\n      europeanCompetition: p1European,\r\n      europeanRound: p1EuropeanResult?.round || null,\r\n      h2hResults: h2h.player1,\r\n      h2hWins: h2h.player1.filter(r => r.goalsFor > r.goalsAgainst).length,\r\n      finishedAboveRival: p1Pos < p2Pos,\r\n      cupRound: cupResult.runs[player1TeamId] || 'R1',\r\n    },\r\n    player2: {\r\n      teamId: player2TeamId,\r\n      teamName: teamMap[player2TeamId]?.name,\r\n      leaguePosition: p2Pos,\r\n      leaguePoints: table.find(t => t.teamId === player2TeamId)?.points || 0,\r\n      liga: p2Pos === 1,\r\n      copa: cupResult.winner === player2TeamId,\r\n      championsLeague: p2EuropeanResult?.won && p2European === 'champions',\r\n      europaLeague: p2EuropeanResult?.won && p2European === 'europaLeague',\r\n      conference: p2EuropeanResult?.won && p2European === 'conference',\r\n      libertadores: p2EuropeanResult?.won && p2European === 'libertadores',\r\n      sudamericana: p2EuropeanResult?.won && p2European === 'sudamericana',\r\n      supercopa: false,\r\n      europeanCompetition: p2European,\r\n      europeanRound: p2EuropeanResult?.round || null,\r\n      h2hResults: h2h.player2,\r\n      h2hWins: h2h.player2.filter(r => r.goalsFor > r.goalsAgainst).length,\r\n      finishedAboveRival: p2Pos < p1Pos,\r\n      cupRound: cupResult.runs[player2TeamId] || 'R1',\r\n    }\r\n  };\r\n}\r\n\r\n// ============================================================\r\n// HELPERS\r\n// ============================================================\r\n\r\nfunction buildMatchContext(fixture, homeTeam, awayTeam, p1Id, p2Id, p1Config, p2Config) {\r\n  const context = {\r\n    homeFormation: '4-3-3',\r\n    awayFormation: '4-3-3',\r\n    homeTactic: 'balanced',\r\n    awayTactic: 'balanced',\r\n    homeMorale: 70,\r\n    awayMorale: 70,\r\n  };\r\n  \r\n  // Apply player configs\r\n  if (fixture.homeTeam === p1Id && p1Config) {\r\n    context.homeFormation = p1Config.formation || '4-3-3';\r\n    context.homeTactic = p1Config.tactic || 'balanced';\r\n    context.homeMorale = p1Config.morale || 75;\r\n  } else if (fixture.homeTeam === p2Id && p2Config) {\r\n    context.homeFormation = p2Config.formation || '4-3-3';\r\n    context.homeTactic = p2Config.tactic || 'balanced';\r\n    context.homeMorale = p2Config.morale || 75;\r\n  }\r\n  \r\n  if (fixture.awayTeam === p1Id && p1Config) {\r\n    context.awayFormation = p1Config.formation || '4-3-3';\r\n    context.awayTactic = p1Config.tactic || 'balanced';\r\n    context.awayMorale = p1Config.morale || 75;\r\n  } else if (fixture.awayTeam === p2Id && p2Config) {\r\n    context.awayFormation = p2Config.formation || '4-3-3';\r\n    context.awayTactic = p2Config.tactic || 'balanced';\r\n    context.awayMorale = p2Config.morale || 75;\r\n  }\r\n  \r\n  return context;\r\n}\r\n\r\nfunction updateTable(table, fixture) {\r\n  const home = table.find(t => t.teamId === fixture.homeTeam);\r\n  const away = table.find(t => t.teamId === fixture.awayTeam);\r\n  if (!home || !away) return;\r\n  \r\n  home.played++;\r\n  away.played++;\r\n  home.goalsFor += fixture.homeScore;\r\n  home.goalsAgainst += fixture.awayScore;\r\n  away.goalsFor += fixture.awayScore;\r\n  away.goalsAgainst += fixture.homeScore;\r\n  \r\n  if (fixture.homeScore > fixture.awayScore) {\r\n    home.won++;\r\n    home.points += 3;\r\n    away.lost++;\r\n  } else if (fixture.homeScore < fixture.awayScore) {\r\n    away.won++;\r\n    away.points += 3;\r\n    home.lost++;\r\n  } else {\r\n    home.drawn++;\r\n    away.drawn++;\r\n    home.points++;\r\n    away.points++;\r\n  }\r\n  \r\n  home.goalDifference = home.goalsFor - home.goalsAgainst;\r\n  away.goalDifference = away.goalsFor - away.goalsAgainst;\r\n}\r\n\r\nfunction sortTable(table) {\r\n  table.sort((a, b) => {\r\n    if (b.points !== a.points) return b.points - a.points;\r\n    if (b.goalDifference !== a.goalDifference) return b.goalDifference - a.goalDifference;\r\n    return b.goalsFor - a.goalsFor;\r\n  });\r\n}\r\n\r\nfunction trackH2H(fixture, p1Id, p2Id, h2h) {\r\n  const isP1Home = fixture.homeTeam === p1Id && fixture.awayTeam === p2Id;\r\n  const isP1Away = fixture.awayTeam === p1Id && fixture.homeTeam === p2Id;\r\n  \r\n  if (isP1Home) {\r\n    h2h.player1.push({ goalsFor: fixture.homeScore, goalsAgainst: fixture.awayScore, home: true });\r\n    h2h.player2.push({ goalsFor: fixture.awayScore, goalsAgainst: fixture.homeScore, home: false });\r\n  } else if (isP1Away) {\r\n    h2h.player1.push({ goalsFor: fixture.awayScore, goalsAgainst: fixture.homeScore, home: false });\r\n    h2h.player2.push({ goalsFor: fixture.homeScore, goalsAgainst: fixture.awayScore, home: true });\r\n  }\r\n}\r\n\r\nfunction getEuropeanCompetition(position, spots) {\r\n  if (spots.champions?.includes(position)) return 'champions';\r\n  if (spots.europaLeague?.includes(position)) return 'europaLeague';\r\n  if (spots.conference?.includes(position)) return 'conference';\r\n  if (spots.libertadores?.includes(position)) return 'libertadores';\r\n  if (spots.sudamericana?.includes(position)) return 'sudamericana';\r\n  return null;\r\n}\r\n\r\n// Simplified European run: probability based on team average overall\r\nfunction simulateEuropeanRun(team, competition) {\r\n  if (!team) return { won: false, round: null };\r\n  \r\n  const avgOverall = team.players \r\n    ? team.players.reduce((sum, p) => sum + (p.overall || 70), 0) / Math.max(1, team.players.length)\r\n    : 70;\r\n  \r\n  // Rounds: Group → R16 → QF → SF → Final\r\n  const rounds = ['Group', 'R16', 'QF', 'SF', 'Final'];\r\n  const isTop = competition === 'champions' || competition === 'libertadores';\r\n  \r\n  // Base advance probability per round (decreasing)\r\n  const baseProbs = isTop \r\n    ? [0.65, 0.50, 0.40, 0.35, 0.30]  // Champions/Libertadores harder\r\n    : [0.75, 0.60, 0.50, 0.40, 0.35];  // Europa/Conference/Sudamericana easier\r\n  \r\n  // Team strength modifier: higher overall = better chance\r\n  const strengthMod = (avgOverall - 70) / 100; // e.g., 80 overall = +0.10\r\n  \r\n  let lastRound = null;\r\n  for (let i = 0; i < rounds.length; i++) {\r\n    const prob = Math.min(0.95, Math.max(0.05, baseProbs[i] + strengthMod));\r\n    if (Math.random() < prob) {\r\n      lastRound = rounds[i];\r\n    } else {\r\n      return { won: false, round: lastRound || rounds[i] };\r\n    }\r\n  }\r\n  \r\n  return { won: true, round: 'Winner' };\r\n}\r\n\r\n// Simplified cup simulation: knockout bracket\r\nfunction simulateCup(allTeams, teamMap, p1Id, p2Id) {\r\n  // Shuffle teams for bracket\r\n  const teamIds = allTeams.map(t => t.id).sort(() => Math.random() - 0.5);\r\n  const runs = {};\r\n  teamIds.forEach(id => { runs[id] = 'R1'; });\r\n  \r\n  let remaining = [...teamIds];\r\n  let roundNum = 1;\r\n  const roundNames = ['R1', 'R2', 'R3', 'QF', 'SF', 'Final'];\r\n  \r\n  while (remaining.length > 1) {\r\n    const nextRound = [];\r\n    const roundName = roundNames[Math.min(roundNum - 1, roundNames.length - 1)];\r\n    \r\n    // Pad to even\r\n    if (remaining.length % 2 !== 0) {\r\n      // Bye for last team\r\n      const bye = remaining.pop();\r\n      nextRound.push(bye);\r\n    }\r\n    \r\n    for (let i = 0; i < remaining.length; i += 2) {\r\n      const homeId = remaining[i];\r\n      const awayId = remaining[i + 1];\r\n      if (!awayId) { nextRound.push(homeId); continue; }\r\n      \r\n      const homeTeam = teamMap[homeId];\r\n      const awayTeam = teamMap[awayId];\r\n      \r\n      if (!homeTeam || !awayTeam) {\r\n        nextRound.push(homeId);\r\n        continue;\r\n      }\r\n      \r\n      const result = simulateMatch(homeId, awayId, homeTeam, awayTeam, {\r\n        importance: roundNum >= 4 ? 'crucial' : 'normal'\r\n      }, {}, null);\r\n      \r\n      let winnerId;\r\n      if (result.homeGoals > result.awayGoals) {\r\n        winnerId = homeId;\r\n      } else if (result.awayGoals > result.homeGoals) {\r\n        winnerId = awayId;\r\n      } else {\r\n        // Penalties: 50/50 with slight home advantage\r\n        winnerId = Math.random() < 0.55 ? homeId : awayId;\r\n      }\r\n      \r\n      nextRound.push(winnerId);\r\n      const nextRoundName = roundNames[Math.min(roundNum, roundNames.length - 1)];\r\n      runs[winnerId] = nextRoundName;\r\n    }\r\n    \r\n    remaining = nextRound;\r\n    roundNum++;\r\n    \r\n    // Safety: max 10 rounds\r\n    if (roundNum > 10) break;\r\n  }\r\n  \r\n  return { winner: remaining[0] || null, runs };\r\n}\r\n\r\n// ============================================================\r\n// TRANSFER SIMULATION (Ranked Quick Mode)\r\n// Instant accept/reject based on team reputation and player value\r\n// ============================================================\r\nexport function attemptTransfer(buyerTeam, sellerTeam, player, allTeams) {\r\n  if (!buyerTeam || !sellerTeam || !player) {\r\n    return { success: false, reason: 'Datos incompletos' };\r\n  }\r\n  \r\n  // Calculate player market value (simplified)\r\n  const baseValue = (player.overall || 70) * 50000;\r\n  const ageModifier = player.age <= 24 ? 1.5 : player.age <= 28 ? 1.2 : player.age <= 32 ? 0.8 : 0.4;\r\n  const value = Math.round(baseValue * ageModifier);\r\n  \r\n  // Can buyer afford it?\r\n  const buyerBudget = buyerTeam.transferBudget || buyerTeam.budget || 5000000;\r\n  if (value > buyerBudget) {\r\n    return { success: false, reason: 'Presupuesto insuficiente', value };\r\n  }\r\n  \r\n  // Reputation check: top players less likely to join worse teams\r\n  const buyerRep = buyerTeam.reputation || 3;\r\n  const sellerRep = sellerTeam.reputation || 3;\r\n  const repDiff = buyerRep - sellerRep;\r\n  \r\n  // Base acceptance probability\r\n  let acceptProb = 0.5;\r\n  acceptProb += repDiff * 0.15; // Better club = more likely\r\n  acceptProb += (player.overall < 75) ? 0.15 : -0.10; // Worse players easier to sign\r\n  acceptProb += (player.age > 30) ? 0.10 : 0; // Older players more available\r\n  \r\n  // Clamp\r\n  acceptProb = Math.max(0.10, Math.min(0.90, acceptProb));\r\n  \r\n  const accepted = Math.random() < acceptProb;\r\n  \r\n  return {\r\n    success: accepted,\r\n    reason: accepted ? 'Fichaje aceptado' : 'El jugador ha rechazado la oferta',\r\n    value,\r\n    probability: Math.round(acceptProb * 100)\r\n  };\r\n}\r\n\r\n// Execute transfer: move player between teams\r\nexport function executeTransfer(buyerTeam, sellerTeam, player) {\r\n  // Remove from seller\r\n  if (sellerTeam.players) {\r\n    sellerTeam.players = sellerTeam.players.filter(p => p.name !== player.name);\r\n  }\r\n  // Add to buyer\r\n  if (buyerTeam.players) {\r\n    buyerTeam.players.push({ ...player });\r\n  }\r\n  return true;\r\n}\r\n"],"names":["simulateHalfSeason","leagueTeams","player1TeamId","player2TeamId","player1Config","player2Config","leagueId","totalMatchdays","LEAGUE_MATCHDAYS","midpoint","table","fixtures","initializeLeague","teamMap","t","h2h","firstHalfFixtures","f","fixture","homeTeam","awayTeam","context","buildMatchContext","result","simulateMatch","updateTable","trackH2H","sortTable","simulateFullSeason","halfSeasonState","secondHalfFixtures","p1Pos","p2Pos","cupResult","simulateCup","europeanSpots","EUROPEAN_SPOTS","p1European","getEuropeanCompetition","p2European","p1EuropeanResult","simulateEuropeanRun","p2EuropeanResult","r","p1Id","p2Id","p1Config","p2Config","home","away","a","b","isP1Home","isP1Away","position","spots","team","competition","avgOverall","sum","p","rounds","baseProbs","strengthMod","lastRound","prob","allTeams","teamIds","runs","id","remaining","roundNum","roundNames","nextRound","bye","i","homeId","awayId","winnerId","nextRoundName","attemptTransfer","buyerTeam","sellerTeam","player","baseValue","ageModifier","value","buyerBudget","buyerRep","sellerRep","repDiff","acceptProb","accepted","executeTransfer"],"mappings":"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"}