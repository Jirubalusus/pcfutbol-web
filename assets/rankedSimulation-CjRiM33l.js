import{i as k,s as v,L as O,E as W}from"./index-DKig0FDC.js";function B(a,o,e,n,d,c){const t=O[c]||38,r=Math.floor(t/2),{table:i,fixtures:u}=k(a,null),p={};a.forEach(l=>{p[l.id]=l});const m={player1:[],player2:[]},h=u.filter(l=>l.week<=r);for(const l of h){const w=p[l.homeTeam],f=p[l.awayTeam];if(!w||!f)continue;const g=L(l,w,f,o,e,n,d),y=v(l.homeTeam,l.awayTeam,w,f,g,{},null);l.homeScore=y.homeGoals,l.awayScore=y.awayGoals,l.played=!0,l.events=y.events||[],G(i,l),H(l,o,e,m)}return D(i),{table:i.map(l=>({...l})),fixtures:u,h2h:m,midpoint:r,totalMatchdays:t,leagueId:c}}function Q(a,o,e,n,d,c){const{table:t,fixtures:r,h2h:i,midpoint:u,totalMatchdays:p,leagueId:m}=a,h={};o.forEach(s=>{h[s.id]=s});const l=r.filter(s=>s.week>u&&!s.played);for(const s of l){const b=h[s.homeTeam],A=h[s.awayTeam];if(!b||!A)continue;const N=L(s,b,A,e,n,d,c),E=v(s.homeTeam,s.awayTeam,b,A,N,{},null);s.homeScore=E.homeGoals,s.awayScore=E.awayGoals,s.played=!0,s.events=E.events||[],G(t,s),H(s,e,n,i)}D(t);const w=t.findIndex(s=>s.teamId===e)+1,f=t.findIndex(s=>s.teamId===n)+1,g=j(o,h),y=W[m]||{},F=T(w,y),S=T(f,y),M=F?P(h[e],F):null,R=S?P(h[n],S):null;return{table:t,player1:{teamId:e,teamName:h[e]?.name,leaguePosition:w,leaguePoints:t.find(s=>s.teamId===e)?.points||0,liga:w===1,copa:g.winner===e,championsLeague:M?.won&&F==="champions",europaLeague:M?.won&&F==="europaLeague",conference:M?.won&&F==="conference",libertadores:M?.won&&F==="libertadores",sudamericana:M?.won&&F==="sudamericana",supercopa:!1,europeanCompetition:F,europeanRound:M?.round||null,h2hResults:i.player1,h2hWins:i.player1.filter(s=>s.goalsFor>s.goalsAgainst).length,finishedAboveRival:w<f,cupRound:g.runs[e]||"R1"},player2:{teamId:n,teamName:h[n]?.name,leaguePosition:f,leaguePoints:t.find(s=>s.teamId===n)?.points||0,liga:f===1,copa:g.winner===n,championsLeague:R?.won&&S==="champions",europaLeague:R?.won&&S==="europaLeague",conference:R?.won&&S==="conference",libertadores:R?.won&&S==="libertadores",sudamericana:R?.won&&S==="sudamericana",supercopa:!1,europeanCompetition:S,europeanRound:R?.round||null,h2hResults:i.player2,h2hWins:i.player2.filter(s=>s.goalsFor>s.goalsAgainst).length,finishedAboveRival:f<w,cupRound:g.runs[n]||"R1"}}}function L(a,o,e,n,d,c,t){const r={homeFormation:"4-3-3",awayFormation:"4-3-3",homeTactic:"balanced",awayTactic:"balanced",homeMorale:70,awayMorale:70};return a.homeTeam===n&&c?(r.homeFormation=c.formation||"4-3-3",r.homeTactic=c.tactic||"balanced",r.homeMorale=c.morale||75):a.homeTeam===d&&t&&(r.homeFormation=t.formation||"4-3-3",r.homeTactic=t.tactic||"balanced",r.homeMorale=t.morale||75),a.awayTeam===n&&c?(r.awayFormation=c.formation||"4-3-3",r.awayTactic=c.tactic||"balanced",r.awayMorale=c.morale||75):a.awayTeam===d&&t&&(r.awayFormation=t.formation||"4-3-3",r.awayTactic=t.tactic||"balanced",r.awayMorale=t.morale||75),r}function G(a,o){const e=a.find(d=>d.teamId===o.homeTeam),n=a.find(d=>d.teamId===o.awayTeam);!e||!n||(e.played++,n.played++,e.goalsFor+=o.homeScore,e.goalsAgainst+=o.awayScore,n.goalsFor+=o.awayScore,n.goalsAgainst+=o.homeScore,o.homeScore>o.awayScore?(e.won++,e.points+=3,n.lost++):o.homeScore<o.awayScore?(n.won++,n.points+=3,e.lost++):(e.drawn++,n.drawn++,e.points++,n.points++),e.goalDifference=e.goalsFor-e.goalsAgainst,n.goalDifference=n.goalsFor-n.goalsAgainst)}function D(a){a.sort((o,e)=>e.points!==o.points?e.points-o.points:e.goalDifference!==o.goalDifference?e.goalDifference-o.goalDifference:e.goalsFor-o.goalsFor)}function H(a,o,e,n){const d=a.homeTeam===o&&a.awayTeam===e,c=a.awayTeam===o&&a.homeTeam===e;d?(n.player1.push({goalsFor:a.homeScore,goalsAgainst:a.awayScore,home:!0}),n.player2.push({goalsFor:a.awayScore,goalsAgainst:a.homeScore,home:!1})):c&&(n.player1.push({goalsFor:a.awayScore,goalsAgainst:a.homeScore,home:!1}),n.player2.push({goalsFor:a.homeScore,goalsAgainst:a.awayScore,home:!0}))}function T(a,o){return o.champions?.includes(a)?"champions":o.europaLeague?.includes(a)?"europaLeague":o.conference?.includes(a)?"conference":o.libertadores?.includes(a)?"libertadores":o.sudamericana?.includes(a)?"sudamericana":null}function P(a,o){if(!a)return{won:!1,round:null};const e=a.players?a.players.reduce((i,u)=>i+(u.overall||70),0)/Math.max(1,a.players.length):70,n=["Group","R16","QF","SF","Final"],c=o==="champions"||o==="libertadores"?[.65,.5,.4,.35,.3]:[.75,.6,.5,.4,.35],t=(e-70)/100;let r=null;for(let i=0;i<n.length;i++){const u=Math.min(.95,Math.max(.05,c[i]+t));if(Math.random()<u)r=n[i];else return{won:!1,round:r||n[i]}}return{won:!0,round:"Winner"}}function j(a,o,e,n){const d=a.map(u=>u.id).sort(()=>Math.random()-.5),c={};d.forEach(u=>{c[u]="R1"});let t=[...d],r=1;const i=["R1","R2","R3","QF","SF","Final"];for(;t.length>1;){const u=[];if(t.length%2!==0){const p=t.pop();u.push(p)}for(let p=0;p<t.length;p+=2){const m=t[p],h=t[p+1];if(!h){u.push(m);continue}const l=o[m],w=o[h];if(!l||!w){u.push(m);continue}const f=v(m,h,l,w,{importance:r>=4?"crucial":"normal"},{},null);let g;f.homeGoals>f.awayGoals?g=m:f.awayGoals>f.homeGoals?g=h:g=Math.random()<.55?m:h,u.push(g);const y=i[Math.min(r,i.length-1)];c[g]=y}if(t=u,r++,r>10)break}return{winner:t[0]||null,runs:c}}function U(a,o,e,n){if(!a||!o||!e)return{success:!1,reason:"Datos incompletos"};const d=(e.overall||70)*5e4,c=e.age<=24?1.5:e.age<=28?1.2:e.age<=32?.8:.4,t=Math.round(d*c),r=a.transferBudget||a.budget||5e6;if(t>r)return{success:!1,reason:"Presupuesto insuficiente",value:t};const i=a.reputation||3,u=o.reputation||3,p=i-u;let m=.5;m+=p*.15,m+=e.overall<75?.15:-.1,m+=e.age>30?.1:0,m=Math.max(.1,Math.min(.9,m));const h=Math.random()<m;return{success:h,reason:h?"Fichaje aceptado":"El jugador ha rechazado la oferta",value:t,probability:Math.round(m*100)}}function _(a,o,e){return o.players&&(o.players=o.players.filter(n=>n.name!==e.name)),a.players&&a.players.push({...e}),!0}export{U as attemptTransfer,_ as executeTransfer,Q as simulateFullSeason,B as simulateHalfSeason};
//# sourceMappingURL=rankedSimulation-CjRiM33l.js.map
